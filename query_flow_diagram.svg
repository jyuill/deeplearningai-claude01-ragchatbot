<?xml version="1.0" encoding="UTF-8"?>
<svg width="1200" height="800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" 
     refX="0" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
    
    <!-- Gradient definitions -->
    <linearGradient id="frontendGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4A90E2;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#357ABD;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="backendGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#7ED321;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#5BA517;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="aiGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#F5A623;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#D6930D;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="dbGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#D0021B;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#A4011A;stop-opacity:1" />
    </linearGradient>
  </defs>
  
  <!-- Background -->
  <rect width="1200" height="800" fill="#f8f9fa"/>
  
  <!-- Title -->
  <text x="600" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#333">
    RAG System Query Processing Flow
  </text>
  
  <!-- Frontend Layer -->
  <rect x="50" y="80" width="200" height="120" rx="10" fill="url(#frontendGrad)" stroke="#2E5C8A" stroke-width="2"/>
  <text x="150" y="100" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">FRONTEND</text>
  <text x="150" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">script.js</text>
  <text x="150" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• User Input</text>
  <text x="150" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• Loading Display</text>
  <text x="150" y="170" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• Response Rendering</text>
  <text x="150" y="185" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• Session Management</text>
  
  <!-- API Layer -->
  <rect x="320" y="80" width="180" height="120" rx="10" fill="url(#backendGrad)" stroke="#4A7C17" stroke-width="2"/>
  <text x="410" y="100" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">FASTAPI</text>
  <text x="410" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">app.py</text>
  <text x="410" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• /api/query endpoint</text>
  <text x="410" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• Request validation</text>
  <text x="410" y="170" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• Session creation</text>
  <text x="410" y="185" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• Response formatting</text>
  
  <!-- RAG System -->
  <rect x="570" y="80" width="180" height="120" rx="10" fill="url(#backendGrad)" stroke="#4A7C17" stroke-width="2"/>
  <text x="660" y="100" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">RAG SYSTEM</text>
  <text x="660" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">rag_system.py</text>
  <text x="660" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• Query orchestration</text>
  <text x="660" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• History management</text>
  <text x="660" y="170" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• Tool coordination</text>
  <text x="660" y="185" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• Source extraction</text>
  
  <!-- AI Generator -->
  <rect x="820" y="80" width="180" height="120" rx="10" fill="url(#aiGrad)" stroke="#B8850A" stroke-width="2"/>
  <text x="910" y="100" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">AI GENERATOR</text>
  <text x="910" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">ai_generator.py</text>
  <text x="910" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• Claude API calls</text>
  <text x="910" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• System prompts</text>
  <text x="910" y="170" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• Tool execution</text>
  <text x="910" y="185" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• Response synthesis</text>
  
  <!-- Search Tools -->
  <rect x="420" y="280" width="180" height="100" rx="10" fill="url(#backendGrad)" stroke="#4A7C17" stroke-width="2"/>
  <text x="510" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">SEARCH TOOLS</text>
  <text x="510" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">search_tools.py</text>
  <text x="510" y="340" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• CourseSearchTool</text>
  <text x="510" y="355" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• Tool definitions</text>
  <text x="510" y="370" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• Parameter handling</text>
  
  <!-- Vector Store -->
  <rect x="670" y="280" width="180" height="100" rx="10" fill="url(#backendGrad)" stroke="#4A7C17" stroke-width="2"/>
  <text x="760" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">VECTOR STORE</text>
  <text x="760" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">vector_store.py</text>
  <text x="760" y="340" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• Semantic search</text>
  <text x="760" y="355" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• Course filtering</text>
  <text x="760" y="370" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• Metadata retrieval</text>
  
  <!-- ChromaDB -->
  <rect x="920" y="280" width="180" height="100" rx="10" fill="url(#dbGrad)" stroke="#7D0115" stroke-width="2"/>
  <text x="1010" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">CHROMADB</text>
  <text x="1010" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">External DB</text>
  <text x="1010" y="340" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• Embedding storage</text>
  <text x="1010" y="355" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• Similarity search</text>
  <text x="1010" y="370" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• Course chunks</text>
  
  <!-- External API -->
  <rect x="1020" y="80" width="130" height="120" rx="10" fill="url(#aiGrad)" stroke="#B8850A" stroke-width="2"/>
  <text x="1085" y="100" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">CLAUDE API</text>
  <text x="1085" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">Anthropic</text>
  <text x="1085" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• LLM processing</text>
  <text x="1085" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• Tool decisions</text>
  <text x="1085" y="170" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• Response gen</text>
  <text x="1085" y="185" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">• Context aware</text>
  
  <!-- Flow Arrows -->
  
  <!-- 1. Frontend to API -->
  <line x1="250" y1="140" x2="320" y2="140" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="285" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">POST /api/query</text>
  <text x="285" y="142" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">{query, session_id}</text>
  
  <!-- 2. API to RAG -->
  <line x1="500" y1="140" x2="570" y2="140" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="535" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">rag_system.query()</text>
  
  <!-- 3. RAG to AI Generator -->
  <line x1="750" y1="140" x2="820" y2="140" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="785" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">generate_response()</text>
  <text x="785" y="142" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">+ tools + history</text>
  
  <!-- 4. AI Generator to Claude API -->
  <line x1="1000" y1="140" x2="1020" y2="140" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="1010" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">API call</text>
  
  <!-- 5. Claude decides to use tools (conditional) -->
  <line x1="910" y1="200" x2="510" y2="280" stroke="#666" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  <text x="710" y="230" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Tool execution</text>
  <text x="710" y="242" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">(if needed)</text>
  
  <!-- 6. Search Tools to Vector Store -->
  <line x1="600" y1="330" x2="670" y2="330" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="635" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">search()</text>
  
  <!-- 7. Vector Store to ChromaDB -->
  <line x1="850" y1="330" x2="920" y2="330" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="885" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">query embeddings</text>
  
  <!-- Return arrows -->
  <!-- ChromaDB to Vector Store -->
  <line x1="920" y1="350" x2="850" y2="350" stroke="#0066CC" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="885" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#0066CC">search results</text>
  
  <!-- Vector Store to Search Tools -->
  <line x1="670" y1="350" x2="600" y2="350" stroke="#0066CC" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="635" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#0066CC">formatted results</text>
  
  <!-- Search Tools back to AI Generator -->
  <line x1="530" y1="280" x2="890" y2="200" stroke="#0066CC" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  <text x="710" y="250" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#0066CC">tool results</text>
  
  <!-- Claude API response -->
  <line x1="1020" y1="160" x2="1000" y2="160" stroke="#0066CC" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="1010" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#0066CC">AI response</text>
  
  <!-- AI Generator to RAG -->
  <line x1="820" y1="160" x2="750" y2="160" stroke="#0066CC" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="785" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#0066CC">synthesized answer</text>
  
  <!-- RAG to API -->
  <line x1="570" y1="160" x2="500" y2="160" stroke="#0066CC" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="535" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#0066CC">(answer, sources)</text>
  
  <!-- API to Frontend -->
  <line x1="320" y1="160" x2="250" y2="160" stroke="#0066CC" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="285" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#0066CC">JSON response</text>
  <text x="285" y="187" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#0066CC">{answer, sources, session_id}</text>
  
  <!-- Session Manager (side component) -->
  <rect x="50" y="250" width="150" height="80" rx="10" fill="#E8E8E8" stroke="#999" stroke-width="2"/>
  <text x="125" y="270" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">Session Manager</text>
  <text x="125" y="290" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">• Conversation history</text>
  <text x="125" y="305" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">• Session tracking</text>
  <text x="125" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">• Context management</text>
  
  <!-- Session Manager connection -->
  <line x1="200" y1="290" x2="570" y2="150" stroke="#999" stroke-width="1" stroke-dasharray="3,3"/>
  
  <!-- Step numbers -->
  <circle cx="275" cy="125" r="12" fill="#FF6B6B" stroke="white" stroke-width="2"/>
  <text x="275" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">1</text>
  
  <circle cx="535" cy="125" r="12" fill="#FF6B6B" stroke="white" stroke-width="2"/>
  <text x="535" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">2</text>
  
  <circle cx="785" cy="125" r="12" fill="#FF6B6B" stroke="white" stroke-width="2"/>
  <text x="785" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">3</text>
  
  <circle cx="1010" cy="125" r="12" fill="#FF6B6B" stroke="white" stroke-width="2"/>
  <text x="1010" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">4</text>
  
  <circle cx="710" cy="210" r="12" fill="#FF9500" stroke="white" stroke-width="2"/>
  <text x="710" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">5</text>
  
  <circle cx="635" cy="310" r="12" fill="#FF9500" stroke="white" stroke-width="2"/>
  <text x="635" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">6</text>
  
  <circle cx="885" cy="310" r="12" fill="#FF9500" stroke="white" stroke-width="2"/>
  <text x="885" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">7</text>
  
  <!-- Legend -->
  <rect x="50" y="430" width="300" height="150" rx="10" fill="white" stroke="#ccc" stroke-width="1"/>
  <text x="200" y="450" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">Flow Legend</text>
  
  <line x1="70" y1="470" x2="110" y2="470" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="120" y="475" font-family="Arial, sans-serif" font-size="11" fill="#333">Request flow</text>
  
  <line x1="70" y1="490" x2="110" y2="490" stroke="#0066CC" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="120" y="495" font-family="Arial, sans-serif" font-size="11" fill="#333">Response flow</text>
  
  <line x1="70" y1="510" x2="110" y2="510" stroke="#666" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  <text x="120" y="515" font-family="Arial, sans-serif" font-size="11" fill="#333">Conditional (tool usage)</text>
  
  <line x1="70" y1="530" x2="110" y2="530" stroke="#999" stroke-width="1" stroke-dasharray="3,3"/>
  <text x="120" y="535" font-family="Arial, sans-serif" font-size="11" fill="#333">Session connection</text>
  
  <circle cx="85" cy="555" r="8" fill="#FF6B6B" stroke="white" stroke-width="1"/>
  <text x="100" y="560" font-family="Arial, sans-serif" font-size="11" fill="#333">Core flow steps</text>
  
  <!-- Data flow labels -->
  <text x="600" y="650" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#333">Data Flow Summary:</text>
  <text x="600" y="675" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">User Query → FastAPI → RAG System → AI Generator → Claude API</text>
  <text x="600" y="695" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">↓ (if search needed)</text>
  <text x="600" y="715" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">Search Tools → Vector Store → ChromaDB → Semantic Results</text>
  <text x="600" y="735" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">↓</text>
  <text x="600" y="755" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">AI Response ← JSON Response ← Synthesized Answer ← Context-Aware Generation</text>
</svg>